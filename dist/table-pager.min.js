var FxpTablePager=function(e,v){"use strict";function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?u(e):t}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}function g(e,t,a){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var o=c(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(a):r.value}})(e,t,a||e)}function i(e,t,a,o){return(i="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,a,o){var r,s,i,n,l=c(e,t);if(l){if((r=Object.getOwnPropertyDescriptor(l,t)).set)return r.set.call(o,a),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(o,t)){if(!r.writable)return!1;r.value=a,Object.defineProperty(o,t,r)}else n=a,(i=t)in(s=o)?Object.defineProperty(s,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[i]=n;return!0})(e,t,a,o)}v=v&&v.hasOwnProperty("default")?v.default:v;var d,t={},h=function(){function a(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};n(this,a),this.guid=v.guid,this.options=v.extend(!0,{},this.constructor.defaultOptions,t),this.$element=v(e)}return r(a,[{key:"destroy",value:function(){var t=this;Object.keys(t).forEach(function(e){delete t[e]})}}],[{key:"defaultOptions",set:function(e){t[this.name]=v.extend(!0,{},t[this.name],e)},get:function(){return void 0===t[this.name]&&(t[this.name]={}),t[this.name]}}]),a}(),b={},m=function(e){function t(){return n(this,t),f(this,l(t).apply(this,arguments))}return a(t,h),r(t,[{key:"locale",value:function(e){return this.constructor.locales[this.getLocale(e)]}},{key:"getLocale",value:function(e){if(this.constructor.locales[e=e||this.options.locale])return e;if(!e){if(void 0===d){var t=document.querySelector('head > meta[http-equiv="Content-Language"]');d=t&&t.content?t.content:null}if(void 0===d){var a=document.querySelector("html").lang;d=a||null}e=d}if("string"==typeof e&&((e=e.toLowerCase().replace("-","_")).indexOf("_")<0||void 0!==this.constructor.locales[e]||(e=e.substr(0,e.indexOf("_")))),void 0===this.constructor.locales[e]){var o=Object.keys(this.constructor.locales);e=0<o.length?o[0]:"en"}return this.options.locale=e}}],[{key:"locales",set:function(e){var t,a,o;if(this.defaultOptions={},"object"===p(e))for(t=Object.keys(e),a=0;a<t.length;++a)"object"===p(o=e[t[a]])&&(void 0===b[this.name]&&(b[this.name]={}),b[this.name][t[a]]=o)},get:function(){return void 0===b[this.name]&&(b[this.name]={}),b[this.name]}},{key:"defaultOptions",get:function(){return g(l(t),"defaultOptions",this)},set:function(e){void 0===e.locale&&(e.locale=null),function(e,t,a,o,r){if(!i(e,t,a,o||e)&&r)throw Error("failed to set property")}(l(t),"defaultOptions",e,this,!0)}}]),t}();function y(e,t){var a=e.get(0)===$(window).get(0)?e.scrollTop():e.offset().top;return e.scrollTop()+t.offset().top-a}function x(e){var t=e.data,a=t.$affixTarget.get(0)===$(window).get(0),o=t.options.affixClass,r=t.options.affixMinHeight,s=a?0:t.$affixTarget.offset().top,i=0<r&&r<=1?t.$affixTarget.height()*r:r,n=t.$table.height()>=i,l=t.$table.offset().top+t.$table.outerHeight()-s-t.$element.outerHeight();void 0!==t.affixDelay&&window.clearTimeout(t.affixDelay),t.$element.is(":visible")||(n=!1),n&&null===t.offsetTop&&(t.offsetTop=y(t.$affixTarget,t.$element)),n&&t.$affixTarget.scrollTop()>t.offsetTop&&0<=l?t.$element.hasClass(o)||(t.affixDelay=window.setTimeout(function(){$("body").addClass(t.options.affixBodyClass),t.$mock.css("height",t.$element.outerHeight(!0)),t.$element.addClass(o),t.$element.before(t.$mock),delete t.affixDelay},50)):t.$element.hasClass(o)&&(t.$element.removeClass(o),t.$mock.detach(),t.$mock.css("height",""),$("body").removeClass(t.options.affixBodyClass))}function P(e){var t,a,o,r=e.data,s=void 0===$(e.target).attr("data-col-name")?$(e.target).parent():$(e.target);e.preventDefault(),void 0!==s.attr("data-col-name")&&(t=e.ctrlKey?r.isMultiSortable():e.ctrlKey,o=void 0===(a=s.attr("data-table-sort"))?"asc":a,void 0===a||"desc"===a?a="asc":"asc"===a&&(a="desc"),!t&&1<r.sortOrder.length&&(a=o),r.sortColumn(s.attr("data-col-name"),t,a))}function S(e){e.data.setPageSize($(e.target).prop("value"))}function k(e){e.data.startPage()}function z(e){e.data.previousPage()}function O(e){e.data.setPageNumber($(e.target).prop("value"))}function w(e){e.data.nextPage()}function T(e){e.data.endPage()}function C(e){e.data.refresh()}function N(e){e.$loadingInfo.remove(),delete e.$loadingInfo}function j(e,t,a){var o,r=e.$table.find(e.options.selectors.sortable+"[data-table-sort]"),s=e.$sortMenu.find(e.options.selectors.listSortable+"[data-table-sort]"),i=r.filter("[data-col-name="+a+"]"),n=s.filter("[data-col-name="+a+"]");void 0!==i.attr("data-table-sort")&&(o={name:a,sort:i.attr("data-table-sort")}),void 0!==n.attr("data-table-sort")&&(o={name:a,sort:n.attr("data-table-sort")}),void 0!==o&&t.push(o)}var M=function(e){function i(e){var t,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};n(this,i),(t=f(this,l(i).call(this,e,a))).$table=v("#"+t.options.tableId),t.$sortMenu=v(t.options.selectors.listSortMenu,t.$element),t.sizeList=[],t.pageSize=t.options.pageSize,t.pageNumber=t.options.pageNumber,t.size=t.options.size||t.getSizeInTable(),t.rows=[],t.sortOrder=t.options.sortOrder,t.setMultiSortable(t.options.multiSortable),t.$affixTarget=!1!==t.options.affixTarget?v(t.options.affixTarget):null,t.$mock=null!==t.$affixTarget?v('<div class="table-pager-mock"></div>'):null,(t.offsetTop=null)!==t.$affixTarget&&t.$affixTarget.on("scroll.fxp.tablepager",null,u(t),x),t.$element.attr("data-size",t.size),t.$table.on("click.fxp.tablepager",t.options.selectors.sortable,u(t),P),t.$sortMenu.on("click.fxp.tablepager",t.options.selectors.listSortable,u(t),P),t.$element.on("change.fxp.tablepager",t.options.selectors.sizeList,u(t),S).on("click.fxp.tablepager",t.options.selectors.startPage,u(t),k).on("click.fxp.tablepager",t.options.selectors.previousPage,u(t),z).on("change.fxp.tablepager",t.options.selectors.pageNumber,u(t),O).on("click.fxp.tablepager",t.options.selectors.nextPage,u(t),w).on("click.fxp.tablepager",t.options.selectors.endPage,u(t),T).on("click.fxp.tablepager",t.options.selectors.refresh,u(t),C);var o,r=v(t.options.selectors.sortable,t.$table),s=v(t.options.selectors.listSortable,t.$sortMenu);for(o=0;o<r.length;o+=1)0===v("> i.table-sort-icon",r.eq(o)).length&&r.eq(o).append(t.options.sortIconTemplate);for(o=0;o<s.length;o+=1)0===v("> i.table-sort-icon",s.eq(o)).length&&s.eq(o).append(t.options.sortIconTemplate);return t.setSizeList(t.options.sizeList),t.refreshPager(!0),t.options.init&&t.refresh(),t}return a(i,m),r(i,[{key:"setMultiSortable",value:function(e){this.multiSortable=e,this.$element.attr("data-multi-sortable",e?"true":"false")}},{key:"isMultiSortable",value:function(){return this.multiSortable}},{key:"sortColumn",value:function(e,t,a){var o,r,s;for(t=(t=void 0!==t&&t)?this.isMultiSortable():t,"asc"!==a&&"desc"!==a&&(a="asc"),r=[],-1===v.inArray(e,o=t?this.sortOrder:[])&&o.push(e),s=0;s<o.length;s+=1)e===o[s]?r.push({name:e,sort:a}):j(this,r,o[s]);!function(e,t){e.sortOrder=[];var a,o,r,s=e.$table.find(e.options.selectors.sortable),i=e.$sortMenu.find(e.options.selectors.listSortable);for(s.removeAttr("data-table-sort"),i.removeAttr("data-table-sort"),r=0;r<t.length;r+=1)a=s.filter("[data-col-name="+t[r].name+"]"),o=i.filter("[data-col-name="+t[r].name+"]"),a.attr("data-table-sort",t[r].sort),o.attr("data-table-sort",t[r].sort),e.sortOrder.push(t[r].name);e.$element.attr("data-sort-order",JSON.stringify(e.sortOrder))}(this,r),this.refresh()}},{key:"setSizeList",value:function(e){var t,a=[];for(t=0;t<e.length;t+=1)"object"===p(e[t])?a.push({value:e[t].value,label:e[t].label}):a.push({value:e[t],label:e[t]});this.options.addAllInSize&&a.push({value:0,label:this.locale().all}),this.sizeList=a,this.$element.attr("data-size-list",JSON.stringify(a))}},{key:"getSizeList",value:function(){return this.sizeList}},{key:"setPageSize",value:function(e){this.pageSize=parseInt(e,10),this.pageNumber=1,this.$element.attr("data-page-size",this.pageSize),this.$element.attr("data-page-number",this.pageNumber),this.refresh()}},{key:"getPageSize",value:function(){return this.pageSize}},{key:"getStart",value:function(){return(this.getPageNumber()-1)*this.getPageSize()+1}},{key:"getEnd",value:function(){return 0===this.getPageSize()?this.getSize():Math.min(this.getSize(),this.getPageSize()*this.getPageNumber())}},{key:"setPageNumber",value:function(e){this.pageNumber=Math.min(e,this.getPageCount()),this.pageNumber=Math.max(this.pageNumber,1),this.$element.attr("data-page-number",this.pageNumber),this.refresh()}},{key:"getPageNumber",value:function(){return this.pageNumber}},{key:"getPageCount",value:function(){return 0===this.pageSize?1:Math.ceil(this.size/this.pageSize)}},{key:"getSize",value:function(){return this.size}},{key:"getSizeInTable",value:function(){return this.$table.find("> tbody > tr[data-row-id]").length}},{key:"getRows",value:function(){return this.rows}},{key:"getItem",value:function(e){var t=this.getRows();return void 0===t[e]?null:t[e]}},{key:"refreshPager",value:function(e){var t,a,o,r,s,i,n,l,u,p,f,c,g;null!==(t=this).options.emptySelector&&(0===t.size?$(t.options.emptySelector).addClass(t.options.emptyClass):$(t.options.emptySelector).removeClass(t.options.emptyClass)),function(e,t){var a,o,r=$(e.options.selectors.sizeList,e.$element),s=e.getSizeList();if(r.attr("disabled","disabled"),t)for(r.empty(),o=0;o<s.length;o+=1)a=$('<option value="'+s[o].value+'">'+s[o].label+"</option>"),s[o].value===e.pageSize&&a.prop("selected","selected"),r.append(a);1<s.length&&r.removeAttr("disabled")}(this,e),a=this,o=$(a.options.selectors.pageNumber,a.$element),r=$("span.table-pager-page-count",a.$element),o.attr("disabled","disabled"),o.prop("value",a.getPageNumber()),r.text(a.getPageCount()),1<a.getPageCount()&&o.removeAttr("disabled"),s=this,i=$(s.options.selectors.startPage,s.$element),n=$(s.options.selectors.previousPage,s.$element),l=$(s.options.selectors.nextPage,s.$element),u=$(s.options.selectors.endPage,s.$element),p=$(s.options.selectors.listSortBtn,s.$element),f=$(s.options.selectors.refresh,s.$element),i.attr("disabled","disabled"),n.attr("disabled","disabled"),l.attr("disabled","disabled"),u.attr("disabled","disabled"),p.removeAttr("disabled"),f.removeAttr("disabled"),1<s.pageNumber&&(i.removeAttr("disabled"),n.removeAttr("disabled")),s.pageNumber<s.getPageCount()&&(l.removeAttr("disabled"),u.removeAttr("disabled")),c=this,g=$("div.table-pager-elements",c.$element),$("> span.table-pager-start",g).text(c.getStart()),$("> span.table-pager-end",g).text(c.getEnd()),$("> span.table-pager-size",g).text(c.getSize())}},{key:"refresh",value:function(){if(void 0===this.$loadingInfo){v(this.options.selectors.sizeList,this.$element).attr("disabled","disabled"),v(this.options.selectors.startPage,this.$element).attr("disabled","disabled"),v(this.options.selectors.previousPage,this.$element).attr("disabled","disabled"),v(this.options.selectors.pageNumber,this.$element).attr("disabled","disabled"),v(this.options.selectors.nextPage,this.$element).attr("disabled","disabled"),v(this.options.selectors.endPage,this.$element).attr("disabled","disabled"),v(this.options.selectors.listSortBtn,this.$element).attr("disabled","disabled"),v(this.options.selectors.refresh,this.$element).attr("disabled","disabled");var e,m=this,t={},a={},o="";null!==this.options.ajaxId&&""!==this.options.ajaxId&&(a.ajax_id=this.options.ajaxId,o=a.ajax_id+"_"),a[o+"ps"]=this.getPageSize(),a[o+"pn"]=this.getPageNumber(),a[o+"p"]=this.options.parameters,a[o+"sc"]=function(e){var t,a=[];for(t=0;t<e.sortOrder.length;t+=1)j(e,a,e.sortOrder[t]);return a}(this),(e=this).$loadingInfo=$(e.options.loadingTemplate),e.$loadingInfo.attr("data-table-pager-loading-info","true"),e.$table.append(e.$loadingInfo),this.$table.trigger(v.Event("table-pager-refreshing",{tablePager:this,ajax:t,ajaxData:a})),null!==this.$affixTarget&&m.$element.hasClass(m.options.affixClass)&&this.$affixTarget.animate({scrollTop:y(m.$affixTarget,m.$mock)+1},this.options.affixScrollSpeed),v.ajax(this.options.url,v.extend(!0,{},t,{type:this.options.method,data:a,success:function(e,t,a){var o,r,s,i,n,l,u,p="_row_id",f="_attr_columns",c=v("> tbody",m.$table),g=v("> thead > tr:last",m.$table).eq(0).children(),d=void 0===e.rows?[]:e.rows,h=[],b={data:e,textStatus:t,jqXHR:a};for(m.$table.trigger(v.Event("table-pager-pre-success",{tablePager:m,ret:b})),l=0;l<d.length;l+=1){for(o=v("<tr></tr>"),void 0!==d[l][p]&&o.attr("data-row-id",d[l][p]),u=0;u<g.length;u+=1){if(r=g.eq(u).attr("data-col-name"),s=v("<td></td>"),void 0!==d[l][f]&&d[l][f][r])for(n in i=d[l][f][r])i.hasOwnProperty(n)&&s.attr(n,i[n]);void 0!==d[l][r]&&s.append(d[l][r]),s.attr("data-col-name",r),o.append(s)}h.push(o)}0===d.length&&null!==m.options.emptyMessage&&(o=v("<tr></tr>"),(s=v("<td></td>")).attr("colspan",g.length),s.append(v("<div />").html(m.options.emptyMessage).text()),o.append(s),h.push(o)),N(m),c.empty(),c.append(h),m.pageNumber=e.pageNumber,m.pageSize=e.pageSize,m.size=e.size,m.$table.trigger(v.Event("table-pager-post-success",{tablePager:m,ret:b})),m.$table.trigger(v.Event("table-pager-refreshed",{tablePager:m,ret:b})),m.refreshPager()},error:function(e,t,a){var o={data:e,textStatus:t,jqXHR:a};N(m),m.$table.trigger(v.Event("table-pager-error",{tablePager:m,ret:o})),m.$table.trigger(v.Event("table-pager-refreshed",{tablePager:m,ret:o})),m.refreshPager()}}))}}},{key:"startPage",value:function(){this.setPageNumber(1)}},{key:"previousPage",value:function(){this.setPageNumber(this.getPageNumber()-1)}},{key:"nextPage",value:function(){this.setPageNumber(this.getPageNumber()+1)}},{key:"endPage",value:function(){this.setPageNumber(this.getPageCount())}},{key:"destroy",value:function(){this.$table.off("click.fxp.tablepager",this.options.selectors.sortable,P),this.$sortMenu.off("click.fxp.tablepager",this.options.selectors.listSortable,P),null!==this.$affixTarget&&this.$affixTarget.off("scroll.fxp.tablepager",null,x),null!==this.$mock&&this.$mock.remove(),this.$element.removeClass(this.options.affixClass),this.$mock.detach(),this.$mock.css("height",""),v("body").removeClass(this.options.affixBodyClass),this.$element.off("change.fxp.tablepager",this.options.selectors.sizeList,S).off("click.fxp.tablepager",this.options.selectors.startPage,k).off("click.fxp.tablepager",this.options.selectors.previousPage,z).off("change.fxp.tablepager",this.options.selectors.pageNumber,O).off("click.fxp.tablepager",this.options.selectors.nextPage,w).off("click.fxp.tablepager",this.options.selectors.endPage,T).off("click.fxp.tablepager",this.options.selectors.refresh,C),g(l(i.prototype),"destroy",this).call(this)}}]),i}();return M.defaultOptions={tableId:null,pageSize:100,pageNumber:1,addAllInSize:!1,sizeList:[2,5,10,25,50,100,150,200],url:null,method:"get",ajaxId:null,parameters:{},multiSortable:!1,sortOrder:[],init:!1,affixTarget:window,affixMinHeight:300,affixClass:"affix",affixBodyClass:"table-pager-affixed",affixScrollSpeed:300,loadingTemplate:'<caption class="default-loading-icon"><i class="fa fa-spin"></i></caption>',sortIconTemplate:'<i class="table-sort-icon fa"></i>',emptyMessage:null,emptySelector:null,emptyClass:"table-empty",selectors:{sizeList:"select.table-pager-size-list",startPage:"button.table-pager-start-page",previousPage:"button.table-pager-previous-page",pageNumber:"input.table-pager-page-number",nextPage:"button.table-pager-next-page",endPage:"button.table-pager-end-page",refresh:"button.table-pager-refresh",listSortBtn:"button.table-pager-list-sort",listSortMenu:"ul.table-pager-list-sort-menu",listSortable:"> li > a[data-table-pager-sortable=true]",sortable:"> thead > tr:last > th[data-table-pager-sortable=true]"}},M.locales={en:{all:"All"}},function(t,n,l){var e=3<arguments.length&&void 0!==arguments[3]&&arguments[3],a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,u=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"destroy",o=v.fn[t];v.fn[t]=function(){for(var r,e,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length,i=Array(1<t?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];return 1===(e=this.each(function(e,t){var a=v(t),o=a.data(n);o||(o=new l(t,"object"===p(s)?s:{}),a.data(n,o)),"string"==typeof s&&o&&(o[s]?r=(r=o[s].apply(o,i))!==o?r:void 0:o.constructor[s]&&(r=(r=o.constructor[s].apply(o,i))!==o?r:void 0),s===u&&a.removeData(n))})).length&&void 0!==r?r:e},v.fn[t].Constructor=l,e&&(v[t]=function(e){return v({})[t](e)}),v.fn[t].noConflict=function(){return v.fn[t]=o},null!==a&&v(window).on("load",function(){v(a).each(function(){var e=v(this);v.fn[t].call(e,e.data())})})}("tablePager","fxp.tablepager",M,!0,'[data-table-pager="true"]'),e.default=M,e}({},jQuery);
